extends layout

block content
  div.container
    div.row
      div.col-12
        h1= title
        p Welcome to #{title}
        form(action="")
          input#message(type="text" name="message") 
          button#btnSubmit(type="button") Submit
    div.row
      div.col-12
        div#result
  script(src="https://code.jquery.com/jquery-3.6.4.min.js")  
  script(src="https://cdn.jsdelivr.net/npm/marked/marked.min.js")  
  script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js") 
  script.
    String.prototype.nl2br = function()
    {
      return this.replace(/\n/g, "<br/>");
    }
    
    $("#btnSubmit").click(async function(){
      var lastResponseLength = false;
      let txtMessage = $("#message").val();
      var ajaxRequest = $.ajax({
          type: 'post',
          url: 'http://localhost:3000/sendMsg',
          data: {"msg":txtMessage},
          dataType: 'json',
          processData: true,
          xhrFields: {
              // Getting on progress streaming response
              onprogress: function(e)
              {
                  var response = marked.parse(e.currentTarget.response);
                  
                  $("#result").html(response);
              }
          }
      });

      // On completed
      ajaxRequest.done(function(data)
      {
          console.log('Complete response = ');
      });
      // On failed
      ajaxRequest.fail(function(error){
          console.log('Error: ', error);
      });

    })